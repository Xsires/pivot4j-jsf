<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<h:head>
	<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
	<title>Pivot4J JSF Sample Application</title>
	<link type="text/css" rel="stylesheet" href="resources/css/style.css" />
	<script type="text/javascript" src="resources/js/mdx.js"></script>
</h:head>

<h:body id="body">
	<f:event type="preRenderView" listener="#{pivotGridHandler.render}" />

	<pe:layout id="workbench" fullPage="true"
		options="#{workbenchHandler.layoutOptions}" widgetVar="workbench">
		<pe:layoutPane id="toolbar-pane" position="north" size="42"
			resizable="false" closable="false" collapsible="false" gutter="0"
			styleClass="toolbar-area">
			<h:form id="toolbar-form">
				<p:toolbar id="toolbar">
					<p:toolbarGroup align="left">
						<p:commandButton type="button" value="About" icon="ui-icon-info"
							onclick="about.show();" />
						<p:separator />
						<h:outputLabel value="Drilldown : " for="drilldown-mode" />
						<p:selectOneButton id="drilldown-mode" style="display: inline"
							value="#{pivotGridHandler.drillDownMode}">
							<f:selectItem itemLabel="Position" itemValue="position" />
							<f:selectItem itemLabel="Member" itemValue="member" />
							<f:selectItem itemLabel="Replace" itemValue="replace" />
							<p:ajax update=":grid-form,:editor-form" />
						</p:selectOneButton>
						<p:separator />
						<p:selectBooleanButton
							value="#{pivotGridHandler.showParentMembers}"
							onLabel="Hide Parent" offLabel="Show Parent"
							onIcon="ui-icon-arrowthickstop-1-n"
							offIcon="ui-icon-arrowthickstop-1-n">
							<p:ajax update=":grid-form,:editor-form" />
						</p:selectBooleanButton>
						<p:selectBooleanButton value="#{pivotGridHandler.hideSpans}"
							onLabel="Show Spans" offLabel="Hide Spans"
							onIcon="ui-icon-circlesmall-minus"
							offIcon="ui-icon-circlesmall-minus">
							<p:ajax update=":grid-form,:editor-form" />
						</p:selectBooleanButton>
						<p:selectBooleanButton value="#{pivotGridHandler.nonEmpty}"
							onLabel="Non Empty" offLabel="Non Empty"
							onIcon="ui-icon-circlesmall-close"
							offIcon="ui-icon-circlesmall-close">
							<p:ajax update=":grid-form,:editor-form"
								listener="#{pivotGridHandler.toggleNonEmpty}" />
						</p:selectBooleanButton>
						<p:selectBooleanButton value="#{pivotGridHandler.swapAxes}"
							onLabel="Swap Axes" offLabel="Swap Axes" onIcon="ui-icon-refresh"
							offIcon="ui-icon-refresh">
							<p:ajax update=":grid-form,:editor-form,:target-tree-form"
								listener="#{pivotGridHandler.toggleSwapAxes}" />
						</p:selectBooleanButton>
						<p:separator />
					</p:toolbarGroup>

					<p:toolbarGroup align="right">
						<p:menuButton value="Links">
							<p:menuitem value="Home"
								url="http://mysticfall.github.com/pivot4j" />
							<p:menuitem value="Project Page"
								url="https://github.com/mysticfall/pivot4j" />
							<p:menuitem value="Discussion Forum"
								url="https://groups.google.com/forum/#!forum/pivot4j-list" />
						</p:menuButton>
					</p:toolbarGroup>
				</p:toolbar>
			</h:form>
		</pe:layoutPane>

		<pe:layoutPane id="navigator-pane" position="west">
			<f:facet name="header">
				<h:outputText value="OLAP Navigator" />
			</f:facet>
			<pe:layoutPane id="source-tree-pane" position="center">
				<f:facet name="header">
					<h:outputText value="Cube Structure" />
				</f:facet>
				<h:form id="source-tree-form">
					<p:tree id="cube-navigator" styleClass="navigator"
						value="#{navigatorHandler.cubeNode}" dynamic="true" cache="true"
						var="node">
						<p:treeNode type="dimension" icon="ui-icon-dim">
							<h:outputText id="dimension-node" value="#{node.name}"
								styleClass="node-dimension" />
						</p:treeNode>

						<p:treeNode type="hierarchy" icon="ui-icon-hier">
							<h:outputText id="hierarchy-node" value="#{node.name}"
								styleClass="node-hierarchy" />
							<p:draggable for="hierarchy-node"
								helper="clone', appendTo: 'body" revert="true" />
						</p:treeNode>

						<p:treeNode type="level" icon="ui-icon-level#{node.depth}">
							<h:outputText id="level-node" value="#{node.name}"
								styleClass="node-level" />
							<!-- workaround for issue #1 -->
							<p:draggable for="level-node" helper="clone', appendTo: 'body"
								revert="true" />
						</p:treeNode>

						<p:treeNode type="member" icon="ui-icon-measure">
							<h:outputText id="member-node" value="#{node.name}"
								styleClass="node-member" />
							<!-- workaround for issue #1 -->
							<p:draggable for="member-node" helper="clone', appendTo: 'body"
								revert="true" />
						</p:treeNode>
					</p:tree>
					<p:droppable for="cube-navigator"
						hoverStyleClass="drop-target-node">
						<p:ajax listener="#{navigatorHandler.onDrop}"
							update=":source-tree-form,:target-tree-form,:grid-form,:editor-form" />
					</p:droppable>
				</h:form>
			</pe:layoutPane>
			<pe:layoutPane id="target-tree-pane" position="south">
				<f:facet name="header">
					<h:outputText value="Pivot Structure" />
				</f:facet>
				<h:form id="target-tree-form">
					<p:tree id="target-navigator" styleClass="navigator"
						value="#{navigatorHandler.targetNode}" dynamic="true" cache="true"
						var="node">
						<p:treeNode type="columns" icon="ui-icon-cols">
							<h:outputText id="columns-node" value="Columns"
								styleClass="node-axis" />
							<p:droppable for="columns-node"
								hoverStyleClass="drop-target-node">
								<p:ajax listener="#{navigatorHandler.onDropOnAxis}"
									update=":source-tree-form,:target-tree-form,:grid-form,:editor-form" />
							</p:droppable>
						</p:treeNode>

						<p:treeNode type="rows" icon="ui-icon-rows">
							<h:outputText id="rows-node" value="Rows" styleClass="node-axis" />
							<p:droppable for="rows-node" hoverStyleClass="drop-target-node">
								<p:ajax listener="#{navigatorHandler.onDropOnAxis}"
									update=":source-tree-form,:target-tree-form,:grid-form,:editor-form" />
							</p:droppable>
						</p:treeNode>

						<p:treeNode type="filter" icon="ui-icon-filter">
							<h:outputText id="filter-node" value="Filter"
								styleClass="node-axis" />
							<p:droppable for="filter-node" hoverStyleClass="drop-target-node" />
						</p:treeNode>

						<p:treeNode type="hierarchy" icon="ui-icon-hier">
							<h:outputText id="hierarchy-node" value="#{node.name}"
								styleClass="node-hierarchy" />
							<!-- workaround for issue #1 -->
							<p:draggable for="hierarchy-node"
								helper="clone', appendTo: 'body" revert="true" />
							<p:droppable for="hierarchy-node"
								hoverStyleClass="drop-target-node">
								<p:ajax listener="#{navigatorHandler.onDropOnHierarchy}"
									update=":source-tree-form,:target-tree-form,:grid-form,:editor-form" />
							</p:droppable>
						</p:treeNode>

						<p:treeNode type="level" icon="ui-icon-level#{node.depth}">
							<h:outputText id="level-node" value="#{node.name}"
								styleClass="node-level" />
							<!-- workaround for issue #1 -->
							<p:draggable for="level-node" helper="clone', appendTo: 'body"
								revert="true" />
						</p:treeNode>

						<p:treeNode type="member" icon="ui-icon-measure">
							<h:outputText id="member-node" value="#{node.name}"
								styleClass="node-member" />
							<!-- workaround for issue #1 -->
							<p:draggable for="member-node" helper="clone', appendTo: 'body"
								revert="true" />
							<p:droppable for="member-node" hoverStyleClass="drop-target-node" />
						</p:treeNode>
					</p:tree>
				</h:form>
			</pe:layoutPane>
		</pe:layoutPane>

		<pe:layoutPane id="content-pane" position="center">
			<f:facet name="header">
				<h:outputText value="Query Result" />
			</f:facet>

			<pe:layoutPane id="grid-content-pane" position="center">
				<h:form id="grid-form">
					<p:panelGrid id="pivot-grid" styleClass="pivot-grid"
						binding="#{pivotGridHandler.pivotGrid}"
						rendered="#{pivotGridHandler.valid}" />

					<h:outputText
						value="You need to put at least one level or measure on Columns and Rows for a valid query."
						styleClass="message-warn" rendered="#{!pivotGridHandler.valid}" />

					<h:inputHidden value="#{pivotGridHandler.drillDownMode}" />
					<h:inputHidden value="#{pivotGridHandler.showParentMembers}" />
					<h:inputHidden value="#{pivotGridHandler.hideSpans}" />
					<h:inputHidden value="#{pivotGridHandler.swapAxes}" />
					<h:inputHidden value="#{pivotGridHandler.nonEmpty}" />
				</h:form>
			</pe:layoutPane>

			<pe:layoutPane id="mdx-editor-pane" position="south">
				<f:facet name="header">
					<h:outputText value="MDX Query" />
				</f:facet>
				<h:form id="editor-form">
					<p:toolbar id="editor-toolbar">
						<p:toolbarGroup align="left">
							<p:commandButton value="Run" icon="ui-icon-play"
								action="#{pivotGridHandler.executeMdx}"
								update=":grid-form,:editor-form" />
							<p:commandButton value="Reset"
								icon="ui-icon-arrowreturnthick-1-w" update="mdx-editor" />
						</p:toolbarGroup>
						<p:toolbarGroup align="right" styleClass="query-info"
							rendered="#{!empty pivotGridHandler.duration}">
							<h:outputText styleClass="ui-icon ui-icon-clock" />
							<h:outputText value="Query execution time : " />
							<h:outputText value="#{pivotGridHandler.duration}">
								<f:convertNumber pattern="###,### msec" />
							</h:outputText>
						</p:toolbarGroup>
					</p:toolbar>
					<pe:codeMirror id="mdx-editor" mode="text/x-mdx"
						value="#{pivotGridHandler.currentMdx}" lineNumbers="true"
						lineWrapping="true" matchBrackets="true" theme="eclipse"
						widgetVar="mdxEditor" required="true" />

					<h:inputHidden value="#{pivotGridHandler.drillDownMode}" />
					<h:inputHidden value="#{pivotGridHandler.showParentMembers}" />
					<h:inputHidden value="#{pivotGridHandler.hideSpans}" />
					<h:inputHidden value="#{pivotGridHandler.swapAxes}" />
					<h:inputHidden value="#{pivotGridHandler.nonEmpty}" />

					<p:growl id="editor-growl" showDetail="true" sticky="true" />
				</h:form>
			</pe:layoutPane>
		</pe:layoutPane>

		<p:ajax event="open" update="editor-form:mdx-editor" />
	</pe:layout>

	<p:dialog id="modalDialog" header="About This Application"
		widgetVar="about" modal="true" height="120" closable="true"
		resizable="false" styleClass="about">
		<h:form id="about-form">
			<h:graphicImage value="/resources/images/pivot4j.png"
				alt="Pivot4J Logo" styleClass="logo" />
			<h:outputText value="Welcome to Pivot4J JSF Sample Application!"
				styleClass="about-title" />
			<h:panelGroup stylcClass="about-text" layout="block">
				<h:outputText
					value="Pivot4J JSF is a sample application built with PrimeFaces to show basic usage of Pivot4J library."
					styleClass="about-text" />
			</h:panelGroup>
			<p:commandButton type="button" value="Close" icon="ui-icon-close"
				onclick="about.hide();" />
		</h:form>
	</p:dialog>

	<p:ajaxStatus styleClass="ajax-status">
		<f:facet name="start">
			<p:graphicImage value="/resources/images/loading.gif" />
		</f:facet>

		<f:facet name="complete">
			<h:outputText value="" />
		</f:facet>
	</p:ajaxStatus>

	<p:growl id="growl" showDetail="true" sticky="true" />
</h:body>
</html>
